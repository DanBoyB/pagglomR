<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use the pagglomR package • pagglomR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use the pagglomR package">
<meta property="og:description" content="pagglomR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pagglomR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demo.html">How to use the pagglomR package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TII-STP/pagglomR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="demo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use the pagglomR package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TII-STP/pagglomR/blob/master/vignettes/demo.Rmd"><code>vignettes/demo.Rmd</code></a></small>
      <div class="hidden name"><code>demo.Rmd</code></div>

    </div>

    
    
<p>This brief vignette demonstrates how the <code>pagglomR</code> package can be used to calculate scheme agglomeration impacts.</p>
<p>Suppose we have a national roads scheme and, as part of the project appraisal process, a transport model has been developed. We have AM, Inter-peak and PM peak models with Cars and HGVs defined as separate user classes. For each future year model, we have a Do Minimum (without scheme) and a Do Something (with scheme) scenario.</p>
<p>Using the strategic transport modelling software (e.g. VISUM, SATURN) we can output text files and/or csv files listing the generalised cost and number of modelled trips for each origin destination pair. This can be output for each scenario and for each time period, user class and journey purpose depending on the structure of the transport model.</p>
<p>For each scenario, mode of travel (i.e. highway and/or public transport) and each forecast year, a weighted average generalised cost is required across each time period, journey purpose, and user class. This can be calculated as follows:</p>
<p><span class="math display">\[
\begin{aligned}
GC_{i, j} ^ {S, m, f} &amp;= \frac{\sum_{p} \ GC_{i, j} ^ {S, m, p, f} \ T_{i, j} ^ {S, m, p, f}} {\sum_{p} \ T_{i, j} ^ {S, m, p, f}}
\end{aligned}
\]</span> where:</p>
<ul>
<li><p><span class="math inline">\(GC_{i, j} ^ {S, m, f}\)</span> is the weighted average generalised costs of travel, between zones <span class="math inline">\(i\)</span> and area <span class="math inline">\(j\)</span>, for each mode <span class="math inline">\(m\)</span> in the scenario <span class="math inline">\(S\)</span> and the forecast year <span class="math inline">\(f\)</span>.</p></li>
<li><p><span class="math inline">\(GC_{i, j} ^ {S, m, p, f}\)</span> is the generalised cost of trips from zone <span class="math inline">\(i\)</span> to zone <span class="math inline">\(j\)</span>, scenario <span class="math inline">\(S\)</span>, mode <span class="math inline">\(m\)</span> and purpose <span class="math inline">\(p\)</span> in the forecast year <span class="math inline">\(f\)</span>.</p></li>
<li><p><span class="math inline">\(T_{i, j} ^ {S, m, p, f}\)</span> is the number of trips from zone <span class="math inline">\(i\)</span> to zone <span class="math inline">\(j\)</span> in the scenario <span class="math inline">\(S\)</span> by mode <span class="math inline">\(m\)</span> and purpose <span class="math inline">\(p\)</span> in the forecast year <span class="math inline">\(f\)</span>.</p></li>
</ul>
<p>In order for the generalised cost files to be read into <code>R</code> and used in the <code>pagglomR</code> package, they should be in comma separated value (csv) format with the column headings <code>o_zone</code>, <code>d_zone</code> and <code>gen_cost</code>.</p>
<p>In the case of outputs from a multi-modal transport model, separate generalised cost skim matrices should be produced for private and public transport modes e.g. road and rail.</p>
<p>Weighted average generalised cost matrices should produced for commuting and business purposes only as productivity benefits are only associated with these journey purposes. Also, the modelled time periods to be included should be based on AM peak, Inter-Peak and PM peak. Off peak periods should not be considered as these periods are not active from the perspective of commuting and business use.</p>
<p>A number of sample generalised cost outputs are included with the <code>pagglomR</code> package for the purposes of this example and for reference.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tii-stp.github.io/pagglomR/index.html">pagglomR</a></span><span class="op">)</span>

<span class="va">dm_2024</span>
<span class="co">#&gt; # A tibble: 12,100 × 3</span>
<span class="co">#&gt;    o_zone d_zone gen_cost</span>
<span class="co">#&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1    358    358       0 </span>
<span class="co">#&gt;  2    358    359     629.</span>
<span class="co">#&gt;  3    358    362    1206.</span>
<span class="co">#&gt;  4    358    381    1790.</span>
<span class="co">#&gt;  5    358    382    2110.</span>
<span class="co">#&gt;  6    358    391    3990.</span>
<span class="co">#&gt;  7    358    393    3188.</span>
<span class="co">#&gt;  8    358    395    4174.</span>
<span class="co">#&gt;  9    358    397    3522.</span>
<span class="co">#&gt; 10    358    399    3432.</span>
<span class="co">#&gt; # … with 12,090 more rows</span></code></pre></div>
<p>A sample jobs file is also included with with the <code>pagglomR</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">jobs</span><span class="op">)</span>
<span class="co">#&gt;   Manufacturing Construction Wholesale_Retail Transport Inf_Comm_Tech</span>
<span class="co">#&gt; 1          4398           94                0      2972             0</span>
<span class="co">#&gt; 2            27           25                0       190             0</span>
<span class="co">#&gt; 3            92           19                0       136             0</span>
<span class="co">#&gt; 4            21           22                0       177             0</span>
<span class="co">#&gt; 5             2            2                0         9             0</span>
<span class="co">#&gt; 6             7            1                0        10             0</span>
<span class="co">#&gt;   Fin_Bus_Services</span>
<span class="co">#&gt; 1             2567</span>
<span class="co">#&gt; 2               33</span>
<span class="co">#&gt; 3               28</span>
<span class="co">#&gt; 4               45</span>
<span class="co">#&gt; 5                2</span>
<span class="co">#&gt; 6                4</span></code></pre></div>
<p>In this example we have 3 modelled years - 2024, 2039 &amp; 2054. We have 2 scenarios for each modelled year - “Do Minimum” and “Do Something”. For each year we first calculate the effective densities for each sector for both scenarios using the generalised costs from the transport model and the jobs data. This is undertaken using the <code><a href="../reference/calc_eff_dens.html">calc_eff_dens()</a></code> function which applies the following formula:</p>
<p><span class="math display">\[
\begin{aligned}
d_i^{S, k, f} &amp;= \sum_{j} \sum_{m} \frac{E_j^{S,f}}{(GC_{i,j}^{S,m,f})a^k}
\end{aligned}
\]</span> where:</p>
<ul>
<li><p><span class="math inline">\(d_i^{S, k, f}\)</span> is the effective density <span class="math inline">\(d\)</span> of origin area <span class="math inline">\(i\)</span> sector <span class="math inline">\(k\)</span> in each scenario <span class="math inline">\(S\)</span> for forecast year <span class="math inline">\(f\)</span>.</p></li>
<li><p><span class="math inline">\(E_j^{S,f}\)</span> is is the total number of jobs for all sectors in zone <span class="math inline">\(j\)</span> for each scenario <span class="math inline">\(S\)</span> for forecast year <span class="math inline">\(f\)</span>. Note that the number of jobs will be the same in both the Without Scheme (i.e. Do Minimum) and With Scheme (i.e. Do Something) scenarios.</p></li>
<li><p><span class="math inline">\(GC_{i,j}^{S,m,f}\)</span> is is the average generalised cost of travel from area <span class="math inline">\(i\)</span> to area <span class="math inline">\(j\)</span> in the scenario <span class="math inline">\(S\)</span> for mode <span class="math inline">\(m\)</span>,</p></li>
<li><p><span class="math inline">\(a^k\)</span> is the is the decay parameter for each sector <span class="math inline">\(k\)</span>. This is held constant irrespective of the forecast year.</p></li>
<li><p><span class="math inline">\(k\)</span> is the is the aggregated industrial sector i.e. Manufacturing, Construction, Wholesale &amp; Retail, Transport, Information &amp; Communications Technology and Financial and Business Services.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 2024</span>
<span class="va">eff_dens_dm_2024</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_eff_dens.html">calc_eff_dens</a></span><span class="op">(</span><span class="va">dm_2024</span>, <span class="va">jobs</span>, <span class="fl">2024</span><span class="op">)</span>
<span class="va">eff_dens_ds_2024</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_eff_dens.html">calc_eff_dens</a></span><span class="op">(</span><span class="va">ds_2024</span>, <span class="va">jobs</span>, <span class="fl">2024</span><span class="op">)</span>

<span class="co"># 2039</span>
<span class="va">eff_dens_dm_2039</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_eff_dens.html">calc_eff_dens</a></span><span class="op">(</span><span class="va">dm_2039</span>, <span class="va">jobs</span>, <span class="fl">2039</span><span class="op">)</span>
<span class="va">eff_dens_ds_2039</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_eff_dens.html">calc_eff_dens</a></span><span class="op">(</span><span class="va">ds_2039</span>, <span class="va">jobs</span>, <span class="fl">2039</span><span class="op">)</span>

<span class="co"># 2054</span>
<span class="va">eff_dens_dm_2054</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_eff_dens.html">calc_eff_dens</a></span><span class="op">(</span><span class="va">dm_2054</span>, <span class="va">jobs</span>, <span class="fl">2054</span><span class="op">)</span>
<span class="va">eff_dens_ds_2054</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_eff_dens.html">calc_eff_dens</a></span><span class="op">(</span><span class="va">ds_2054</span>, <span class="va">jobs</span>, <span class="fl">2054</span><span class="op">)</span></code></pre></div>
<p>In the case of a multi-modal assessment, separate effective density calculations should be run using the generalised costs from the private and public transport modes. These matrices should then be summed for each forecast year and scenario to form the effective density matrices to be then used for the calculation of productivity impacts.</p>
<p>We can then calculate the productivity impacts for each modelled year using the effective density calculations for the “Do Minimum” and “Do Something” scenarios and the jobs data. The productivity impacts are calculated by applying the following formula:</p>
<p><span class="math display">\[
\begin{aligned}
WEI_i^{k, f} &amp;= \left[ \left( \frac{d_i^{DS, k, f}}{d_i^{DM, k, f}} \right)^{\rho^k} - 1\right] GVA_i^{DM,k,f} E_i^{DM,k,f}
\end{aligned}
\]</span> where:</p>
<ul>
<li><p><span class="math inline">\(WEI_i^{k, f}\)</span> is the sectoral agglomeration impacts for each zone <span class="math inline">\(i\)</span> and sector <span class="math inline">\(k\)</span> in each forecast year <span class="math inline">\(f\)</span>.</p></li>
<li><p><span class="math inline">\(d_i^{DS, k, f}\)</span> and <span class="math inline">\(d_i^{DM, k, f}\)</span> are the effective densities of origin zone <span class="math inline">\(i\)</span> and sector <span class="math inline">\(k\)</span> in the “Do Something” and the “Do Minimum” scenarios respectively. This will vary depending on the forecast year (f)3 due to the change in the Generalised Cost of Travel over time associated with higher levels of traffic demand.</p></li>
<li><p><span class="math inline">\(\rho^k\)</span> is the elasticity of productivity with respect to effective density for sector <span class="math inline">\(k\)</span>. This is held constant irrespective of the forecast year.</p></li>
<li><p><span class="math inline">\(GVA_i^{DM,k,f}\)</span> is the Gross Value Added (GVA) per worker of each area <span class="math inline">\(i\)</span> and sector <span class="math inline">\(k\)</span> in the Do Minimum scenario. This will vary depending on the forecast year <span class="math inline">\(f\)</span> in line with expected productivity growth.</p></li>
<li><p><span class="math inline">\(E_i^{DM,k,f}\)</span> is the total number of jobs in sector <span class="math inline">\(k\)</span> in origin area <span class="math inline">\(i\)</span> in the Do Minimum scenario. This will vary depending on the forecast year <span class="math inline">\(f\)</span> in line with projected job growth.</p></li>
</ul>
<p>The <code><a href="../reference/calc_prod_impacts.html">calc_prod_impacts()</a></code> function sums the above sectoral agglomeration impacts into an overall productivity impact in Euro (€, in 201X prices).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 2024</span>
<span class="va">prod_2024</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_prod_impacts.html">calc_prod_impacts</a></span><span class="op">(</span><span class="va">eff_dens_dm_2024</span>, <span class="va">eff_dens_ds_2024</span>, <span class="va">jobs</span><span class="op">)</span>

<span class="co"># 2039</span>
<span class="va">prod_2039</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_prod_impacts.html">calc_prod_impacts</a></span><span class="op">(</span><span class="va">eff_dens_dm_2039</span>, <span class="va">eff_dens_ds_2039</span>, <span class="va">jobs</span><span class="op">)</span>

<span class="co"># 2054</span>
<span class="va">prod_2054</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_prod_impacts.html">calc_prod_impacts</a></span><span class="op">(</span><span class="va">eff_dens_dm_2054</span>, <span class="va">eff_dens_ds_2054</span>, <span class="va">jobs</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/discounted_prod.html">discounted_prod()</a></code> function reads in the productivity benefits calculated for each modelled year and interpolates values for years in between the modelled years.</p>
<p>It also calculates nominal productivity benefits per annum by applying GVA growth based on the rates in Table 4 of PAG Unit 6.11. Discounted benefits are then calculated by applying the test discount rate to the nominal benefits. This is undertaken for the 30 year appraisal period plus a 30 year residual value period.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># discounted table of benefits</span>
<span class="va">discounted_benefits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discounted_prod.html">discounted_prod</a></span><span class="op">(</span>appraisal_year <span class="op">=</span> <span class="fl">2020</span>,
                                       <span class="va">prod_2024</span>, 
                                       <span class="va">prod_2039</span>,
                                       <span class="va">prod_2054</span><span class="op">)</span>

<span class="va">discounted_benefits</span>
<span class="co">#&gt; # A tibble: 64 × 5</span>
<span class="co">#&gt;     year modelled appraisal_year  nominal discounted</span>
<span class="co">#&gt;    &lt;dbl&gt;    &lt;dbl&gt;          &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2020       0               1       0          0 </span>
<span class="co">#&gt;  2  2021       0               2       0          0 </span>
<span class="co">#&gt;  3  2022       0               3       0          0 </span>
<span class="co">#&gt;  4  2023       0               4       0          0 </span>
<span class="co">#&gt;  5  2024 2707225.              5 3477106.   2088260.</span>
<span class="co">#&gt;  6  2025 2721508.              6 3575846.   2064962.</span>
<span class="co">#&gt;  7  2026 2735791.              7 3677288.   2041868.</span>
<span class="co">#&gt;  8  2027 2750074.              8 3781506.   2018977.</span>
<span class="co">#&gt;  9  2028 2764357.              9 3888572.   1996289.</span>
<span class="co">#&gt; 10  2029 2778640.             10 3998562.   1973803.</span>
<span class="co">#&gt; # … with 54 more rows</span></code></pre></div>
<p>The discounted benefits can be summarised into a total present value benefit over the 30 year appraisal period, and a separate total for the residual value period using the <code><a href="../reference/prod_summary.html">prod_summary()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">summary_benefits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prod_summary.html">prod_summary</a></span><span class="op">(</span><span class="va">discounted_benefits</span><span class="op">)</span>

<span class="va">summary_benefits</span>
<span class="co">#&gt; # A tibble: 2 × 2</span>
<span class="co">#&gt;   period                  pv_benefits</span>
<span class="co">#&gt;   &lt;chr&gt;                         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 30 year benefits          53425447.</span>
<span class="co">#&gt; 2 Residual value benefits   44331675.</span></code></pre></div>
<p>The total productivity impacts in present value terms can be calculated using:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">summary_benefits</span><span class="op">$</span><span class="va">pv_benefits</span><span class="op">)</span>
<span class="co">#&gt; [1] 97757122</span></code></pre></div>
<p>This can be added to the transport user benefits to produce an updated benefit cost ratio (BCR) as part of a sensitivity test around the central case in the scheme appraisal.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dan Brennan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
